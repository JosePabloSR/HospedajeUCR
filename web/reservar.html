<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/Html.html to edit this template
-->
<html>
    <head>
        <title>Reservaciones</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <script>
            // Datos de disponibilidad de las camas
            var disponibilidadCamas = {
                habitacion1: {
                    cama1: true,
                    cama2: true
                },
                habitacion2: {
                    cama1: true,
                    cama2: true
                }
            };
            // Function to show the data entry form
            function mostrarSolicitudDatos() {
                var reservaBtns = document.querySelector('.vertical-buttons');
                reservaBtns.style.display = 'none';
                document.getElementById('solicitudDatos').style.display = 'block';
            }

            // Function to make a reservation
            function reservar() {
                var entrada = document.getElementById('fechaEntrada').value;
                var horaEntrada = document.getElementById('horaEntrada').value;
                var salida = document.getElementById('fechaSalida').value;
                var horaSalida = document.getElementById('horaSalida').value;
                var nombreReservacion = document.getElementById('nombreReservacion').value;
                var idReservado = document.getElementById('idReservado').value;
                var nombreReservado = document.getElementById('nombreReservado').value;
                var habitacion = document.getElementById('habitacion').value;
                var cama = document.getElementById('cama').value;

                // Check bed availability
                if (!disponibilidadCamas[habitacion][cama]) {
                    alert('La cama seleccionada no está disponible durante ese período de tiempo.');
                    return;
                }

                var fechaReserva = new Date().toLocaleString();

                // Store reservation data in localStorage
                localStorage.setItem('entrada', entrada);
                localStorage.setItem('horaEntrada', horaEntrada);
                localStorage.setItem('salida', salida);
                localStorage.setItem('horaSalida', horaSalida);
                localStorage.setItem('nombreReservacion', nombreReservacion);
                localStorage.setItem('idReservado', idReservado);
                localStorage.setItem('nombreReservado', nombreReservado);
                localStorage.setItem('fechaReserva', fechaReserva);
                localStorage.setItem('habitacion', habitacion);
                localStorage.setItem('cama', cama);

                // Mark bed as unavailable
                disponibilidadCamas[habitacion][cama] = false;

                // Hide the data entry form and show the success message
                document.getElementById('solicitudDatos').style.display = 'none';
                document.getElementById('reservaMsg').style.display = 'block';
                document.getElementById('nuevaReservacionBtn').style.display = 'block';
            }

            // Function to display active reservations
            function mostrarReservacionesActivas() {
                // Retrieve reservation data from localStorage
                var entrada = localStorage.getItem('entrada');
                var horaEntrada = localStorage.getItem('horaEntrada');
                var salida = localStorage.getItem('salida');
                var horaSalida = localStorage.getItem('horaSalida');
                var nombreReservacion = localStorage.getItem('nombreReservacion');
                var fechaReserva = localStorage.getItem('fechaReserva');
                var habitacion = localStorage.getItem('habitacion');
                var cama = localStorage.getItem('cama');
                var mensaje = 'Reservaciones activas:\n\n';

                if (entrada && horaEntrada && salida && horaSalida && nombreReservacion && fechaReserva && habitacion && cama) {
                    mensaje += 'Entrada: ' + entrada + ' ' + horaEntrada + '\n';
                    mensaje += 'Salida: ' + salida + ' ' + horaSalida + '\n';
                    mensaje += 'Nombre de la reservación: ' + nombreReservacion + '\n';
                    mensaje += 'Fecha de reserva: ' + fechaReserva + '\n';
                    mensaje += 'Habitación: ' + habitacion + '\n';
                    mensaje += 'Cama: ' + cama;
                } else {
                    mensaje += 'No hay reservaciones activas.';
                }

                alert(mensaje);
            }

            function cargarHoras() {
                var selectHoraEntrada = document.getElementById('horaEntrada');
                var selectHoraSalida = document.getElementById('horaSalida');
                var segundos = 0;
                for (var hora = 0; hora < 24; hora++) {
                    for (var minuto = 0; minuto < 60; minuto += 30) {
                        var horaTexto = pad(hora) + ':' + pad(minuto) + ':' + pad(segundos);
                        var opcionEntrada = new Option(horaTexto, horaTexto, horaTexto);
                        var opcionSalida = new Option(horaTexto, horaTexto, horaTexto);
                        selectHoraEntrada.add(opcionEntrada);
                        selectHoraSalida.add(opcionSalida);
                    }
                }
            }

            function pad(valor) {
                return ('0' + valor).slice(-2);
            }

            function nuevaReservacion() {
                document.getElementById('solicitudDatos').style.display = 'block';
                document.getElementById('reservaMsg').style.display = 'none';
                document.getElementById('nuevaReservacionBtn').style.display = 'none';
                limpiarDatosReserva();
            }

            function limpiarDatosReserva() {
                document.getElementById('fechaEntrada').value = '';
                document.getElementById('horaEntrada').selectedIndex = 0;
                document.getElementById('fechaSalida').value = '';
                document.getElementById('horaSalida').selectedIndex = 0;
                document.getElementById('nombreReservacion').value = '';
                document.getElementById('idReservado').value = '';
                document.getElementById('idReservado').value = '';
                document.getElementById('habitacion').selectedIndex = 0;
                document.getElementById('cama').selectedIndex = 0;
            }
            let data = [];
            function addData(event) {
                event.preventDefault(); // Evita que el formulario se envíe y la página se recargue

                // Obtén los valores ingresados en el formulario
                const nombreReservacion = document.querySelector('input[name="nombreReservacion"]').value;
                const idReservado = document.querySelector('input[name="idReservado"]').value;
                const nombreReservado = document.querySelector('input[name="nombreReservado"]').value;
                // Agrega los datos al array
                data.push({nombreReservado, idReservado, nombreReservacion});

                // Actualiza la lista de datos
                updateDataList();
            }

            function updateDataList() {
                const dataList = document.getElementById('dataList');
                dataList.innerHTML = '';

                // Agrega los elementos del array como elementos de lista
                for (let i = 0; i < data.length; i++) {
                    const li = document.createElement('li');
                    li.textContent = `nombreReservacion ${data[i].nombreReservacion}, idReservado ${data[i].idReservado}, nombreReservado ${data[i].nombreReservado}`;
                    dataList.appendChild(li);
                }
            }

            function sortData() {
                // Realiza el ordenamiento por inserción
                for (let i = 1; i < data.length; i++) {
                    const key = data[i];
                    let j = i - 1;
                    while (j >= 0 && data[j].name.toLowerCase() > key.name.toLowerCase()) {
                        data[j + 1] = data[j];
                        j = j - 1;
                    }
                    data[j + 1] = key;
                }

                // Actualiza la lista de datos ordenados
                updateDataList();
            }
        </script>
    </head>

    <body onload="cargarHoras();">
        <div class="container mt-4">
            <div id="solicitudDatos">
                <h2>Ingrese los datos de la reserva</h2>
                <form method="post" action="reservationValidation.jsp">
                    <div class="form-group">
                        <label for="fechaEntrada">Fecha de entrada:</label>
                        <input type="date" class="form-control" id="fechaEntrada" name="fechaEntrada" required>
                        <label for="horaEntrada">Hora de entrada:</label>
                        <select class="form-control" id="horaEntrada" name="horaEntrada" required></select>
                    </div>
                    <div class="form-group">
                        <label for="fechaSalida">Fecha de salida:</label>
                        <input type="date" class="form-control" id="fechaSalida" name="fechaSalida" required>
                        <label for="horaSalida">Hora de salida:</label>
                        <select class="form-control" id="horaSalida" name="horaSalida" required></select>
                    </div>
                    <div class="form-group">
                        <label for="nombreReservacion">Nombre de la persona que realizará la reservación:</label>
                        <input type="text" class="form-control" id="nombreReservacion" name="nombreReservacion"placeholder="nombreReservacion" required>
                    </div>
                    <div class="form-group">
                        <label for="idReservado">Id de la persona a la que se le realizará la reservación:</label>
                        <input type="text" class="form-control" id="nombreReservacion" name="idReservado"placeholder="idReservado" required>
                    </div>
                    <div class="form-group">
                        <label for="nombreReservado">Nombre de la persona a la que se le realizará la reservación:</label>
                        <input type="text" class="form-control" id="nombreReservacion" name="nombreReservado" placeholder="nombreReservado" required>
                                  </div>
                    <div class="form-group">
                        <label for="habitacion">Habitación:</label>
                        <select class="form-control" id="habitacion" name="habitacion" required>
                            <option value="1">Habitación 1</option>
                            <option value="2">Habitación 2</option>
                            <option value="3">Habitación 3</option>
                            <option value="4">Habitación 4</option>
                            <option value="5">Habitación 5</option>
                            <option value="6">Habitación 6</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cama">Cama:</label>
                        <select class="form-control" id="cama" name="cama" required>
                            <option value="1">Cama 1</option>
                            <option value="2">Cama 2</option>
                        </select>
                    </div>
                    <input type="submit" value="Reservar" class="btn-primary" onclick="addData(event)>
                    </div>
                    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" type="text/javascript"></script>

                    </body>
                    </html>
